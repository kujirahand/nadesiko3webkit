{"version":3,"file":"plugin_kansuji.js","mappings":"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","sources":["webpack://nadesiko3/./src/plugin_kansuji.mjs"],"sourcesContent":["// @ts-nocheck\r\nconst PluginKansuji = {\r\n\r\n  '初期化': {\r\n    type: 'func',\r\n    josi: [],\r\n    pure: true,\r\n    fn: function (sys) {\r\n    }\r\n  },\r\n\r\n  // @漢数字関連\r\n  '漢数字': { // @引数を数字と解釈して漢数字の文字列を返す // @かんすうじ\r\n    type: 'func',\r\n    josi: [['を', 'の']],\r\n    pure: true,\r\n    fn: function (input) {\r\n      function preprocesser (input) {\r\n        // eslint-disable-next-line camelcase\r\n        function if_number_is_exponent (input) {\r\n          const match = input.match(/[0-9]*\\.?[0-9]+[eE][-+]?[0-9]+/)\r\n          if (match && match[0] === input) {\r\n            const base = input.match(/[0-9]*\\.?[0-9]+[eE]/)[0].slice(0, -1)\r\n            const exponent = input.match(/[eE][-+]?[0-9]+/)[0].slice(1)\r\n            // eslint-disable-next-line no-inner-declarations\r\n            function movepoint (base, exponent) {\r\n              const sign = exponent[0]\r\n              const curpointidx = base.includes('.') ? base.indexOf('.') : base.length\r\n              const idx = sign === '-' ? curpointidx - parseInt(exponent.slice(1)) : curpointidx + parseInt(exponent.match(/[0-9]+$/)[0])\r\n              function strIns (str, idx, val) {\r\n                return str.slice(0, idx) + val + str.slice(idx)\r\n              }\r\n              if (idx > 0) {\r\n                if (base.length - curpointidx > idx) {\r\n                  return strIns(base.replace('.', ''), idx, '.')\r\n                } else {\r\n                  if (base.includes('.')) {\r\n                    return base.replace('.', '') + '0'.repeat(idx - base.length + curpointidx)\r\n                  } else {\r\n                    return base + '0'.repeat(idx - base.length + curpointidx - 1)\r\n                  }\r\n                }\r\n              } else {\r\n                return '0.' + '0'.repeat(-idx) + base.replace('.', '')\r\n              }\r\n            }\r\n            input = movepoint(base, exponent)\r\n          }\r\n          return input\r\n        }\r\n        function asciify (input) { // 全角数字を半角数字に\r\n          return input.replace(/[０-９]/g, s => {\r\n            return String.fromCharCode(s.charCodeAt(0) - 65248)\r\n          })\r\n        }\r\n        input = asciify(input)\r\n        if (Number.isNaN(Number(input))) { throw new Error('『漢数字』命令の中に無効な文字が含まれています。') }\r\n        const output = if_number_is_exponent(input.toString())\r\n        // eslint-disable-next-line no-loss-of-precision\r\n        if (output > BigInt(999999999999999999999999999999999999999999999999999999999999999999999999)) { throw new Error('『漢数字』命令の中に含められる数の大きさを超えています。') }\r\n        return output\r\n      }\r\n      input = preprocesser(String(input))\r\n      function separater (str) {\r\n        let isminus = str.includes('.')\r\n        return str.split('').reverse().reduce((acc, cur) => {\r\n          if (cur === '.') {\r\n            isminus = false\r\n            acc.splice(1, 0, '.')\r\n            return acc\r\n          } else if (isminus) {\r\n            acc.splice(1, 0, cur)\r\n            return acc\r\n          }\r\n          if (acc[0].length === 軸数字.length) {\r\n            acc.unshift([])\r\n          }\r\n          acc[0].unshift(cur)\r\n          return acc\r\n        }, [[]])\r\n      }\r\n      function converter (arr) {\r\n        function replacer (str) {\r\n          return 基本漢数字[基本算用数字.indexOf(str)]\r\n        }\r\n        let adjuster = 0\r\n        const result = arr.reverse().reduce((acc, cur, idx) => {\r\n          if (typeof cur === 'string') {\r\n            if (cur === '.') {\r\n              acc = '・' + acc\r\n              adjuster = idx + 1\r\n            } else {\r\n              acc = replacer(cur) + acc\r\n            }\r\n          } else {\r\n            const unit = cur.reduce((acc, cur, idx, src) => {\r\n              if (cur === '0') {\r\n                return acc\r\n              } else if (cur === '1' && 軸数字[src.length - 1 - idx] !== '') {\r\n                return acc + 軸数字[src.length - 1 - idx]\r\n              } else {\r\n                return acc + replacer(cur) + 軸数字[src.length - 1 - idx]\r\n              }\r\n            }, '')\r\n            acc = (unit ? unit + 単位数字[idx - adjuster] : '') + acc\r\n          }\r\n          return acc\r\n        }, '')\r\n        return result[0] === '・' ? '零' + result : result\r\n      }\r\n      // フラグを覚えておく #874\r\n      let flag = ''\r\n      if (input.charAt(0) === '+' || input.charAt(0) === '-') {\r\n        flag = input.charAt(0)\r\n        input = input.substr(1)\r\n      }\r\n      let res = converter(separater(input))\r\n      if (res === '') { res = '零' }\r\n      return flag + res\r\n    }\r\n  },\r\n  '算用数字': { // @U引数を漢数字と解釈して数値を返す // @さんようすうじ\r\n    type: 'func',\r\n    josi: [['を', 'の']],\r\n    pure: true,\r\n    fn: function (input) {\r\n      function converter (src) {\r\n        const multibytes = 単位数字.filter(a => a.length > 1)\r\n        const result = []\r\n        for (let idx = 0; idx < src.length; idx++) {\r\n          const cur = src.slice(idx, idx + 1)\r\n          const 指数 = 単位数字.includes(cur) ? cur : multibytes.find(v => v === src.slice(idx, idx + v.length))\r\n          const 位 = 軸数字.includes(cur) ? cur : null\r\n          const 底 = 基本漢数字.includes(cur) ? cur : null\r\n          if (指数) {\r\n            if (指数.length > 1) {\r\n              idx += 指数.length - 1\r\n            }\r\n            result.push(BigInt('1' + '0'.repeat(4 * 単位数字.indexOf(指数))))\r\n          } else if (位) {\r\n            result.push(10 ** (軸数字.indexOf(位)))\r\n          } else if (底) {\r\n            result.push(基本漢数字.indexOf(底))\r\n          } else if (cur === '・') {\r\n            result.push('.')\r\n          } else if (cur === '零') {\r\n            result.push('0')\r\n          } else {\r\n            throw new Error('『算用数字』命令の中に無効な文字が含まれています。')\r\n          }\r\n        }\r\n        return result\r\n      }\r\n      function separater (arr) {\r\n        let base = []\r\n        let unit = []\r\n        let isminus = false\r\n        return arr.reduce((acc, cur, idx) => {\r\n          if (cur === '.') {\r\n            if (base.length === 0) { base.push(0, 1) }\r\n            if (base.length === 1) { base.push(1) }\r\n            unit.push(base)\r\n            base = []\r\n            acc.push(unit)\r\n            acc.push('.')\r\n            unit = []\r\n            isminus = true\r\n          } else if (isminus) {\r\n            acc.push(String(cur))\r\n          } else if (cur > 1000) {\r\n            if (base.length === 0) { base.push(0, 1) }\r\n            if (base.length === 1) { base.push(1) }\r\n            unit.push(base)\r\n            base = []\r\n            unit.push(cur)\r\n            acc.push(unit)\r\n            unit = []\r\n          } else if (cur >= 10 && cur <= 1000) {\r\n            if (base.length === 0) { base.push(1) }\r\n            base.push(cur)\r\n            unit.push(base)\r\n            base = []\r\n          } else if (cur < 10) {\r\n            base.push(cur)\r\n          }\r\n          if (idx + 1 === arr.length && isminus === false) {\r\n            if (base.length === 1) {\r\n              base.push(1)\r\n              unit.push(base)\r\n            }\r\n            acc.push(unit)\r\n          }\r\n          return acc\r\n        }, [])\r\n      }\r\n      function calculator (arr) {\r\n        return arr.reduce((acc, cur, idx) => {\r\n          return typeof cur === 'string'\r\n            ? acc + cur\r\n            : acc + cur.reduce((acc, cur, idx) => {\r\n              return cur > 1000 ? acc * cur : acc + BigInt(cur[0] * cur[1])\r\n            }, BigInt(0))\r\n        }, BigInt(0))\r\n      }\r\n      const tmp = calculator(separater(converter(input.toString())))\r\n      return tmp > Number.MAX_SAFE_INTEGER ? tmp : Number(tmp)\r\n    }\r\n  }\r\n}\r\n\r\nconst 単位数字 = [\r\n  '', '万', '億', '兆', '京', '垓', '𥝱', '穣', '溝', '澗', '正',\r\n  '載', '極', '恒河沙', '阿僧祇', '那由他', '不可思議', '無量大数'\r\n]\r\nconst 軸数字 = [\r\n  '', '十', '百', '千'\r\n]\r\nconst 基本算用数字 = '0123456789'.split('')\r\nconst 基本漢数字 = '〇一二三四五六七八九'.split('')\r\n\r\nexport default PluginKansuji\r\n\r\n// scriptタグで取り込んだ時、自動で登録する\r\nif (typeof (navigator) === 'object' && typeof (navigator.nako3) === 'object') { navigator.nako3.addPluginObject('PluginKansuji', PluginKansuji) }\r\n"],"names":["PluginKansuji","type","josi","pure","fn","sys","input","flag","replace","s","String","fromCharCode","charCodeAt","asciify","Number","isNaN","Error","output","match","base","slice","exponent","movepoint","sign","curpointidx","includes","indexOf","length","idx","parseInt","str","val","strIns","repeat","if_number_is_exponent","toString","BigInt","preprocesser","charAt","substr","res","arr","replacer","adjuster","result","reverse","reduce","acc","cur","unit","src","converter","isminus","split","splice","unshift","separater","tmp","push","multibytes","filter","a","find","v","MAX_SAFE_INTEGER","navigator","nako3","addPluginObject"],"sourceRoot":""}